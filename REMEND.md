# 「零」文件

一个名为"「零」文件"的多端文件

### 一、技术选型方案

1. **核心框架**：Electron + Node.js
2. **界面库**：原生HTML/CSS + 少量Preact（轻量级React替代）
3. **文件处理**：
   - `fs-extra` 强化文件操作
   - `chokidar` 文件监听
   - `sharp` 图片格式转换
   - `ffmpeg-static` 音视频转换
   - `pdf-lib` PDF处理
   - `jszip` 压缩文件处理

### 二、架构设计

- Electron + JavaScript

1. **主进程**：
   - 文件系统操作
   - 格式转换任务队列
   - 系统级API调用
2. **渲染进程**：
   - 界面展示
   - 用户交互处理
   - 文件元数据处理

### 三、核心功能实现路径

#### （一）文件分类模块

1. 使用`electron.dialog`获取目标路径
2. 递归遍历目录时：
   - 按扩展名分类到预设的8个类别
   - 生成包含路径/大小/修改时间的元数据
   - 采用`worker_threads`处理大型目录
3. 建立内存索引数据库（可选`lowdb`）
4. 文件类型格式：图片：`jpg/jpeg/png/gif/bmp/tiff/svg/webp/ico`，视频：`mp4/avi/mov/wmv/webm/flv`，音频：`mp3/wav/aac/flac/ogg/wma`,文档：`pdf/doc/docx/txt`，表格：`xls/xlsx/csv`，PPT：`ppt/pptx`，压缩文件：`zip/rar/7z/gz/tar/bz2`,其他文件等

#### （二）格式转换模块

1. **转换策略**：
   - 图片：`sharp`实现WebP/JPG/PNG互转
   - 音视频：封装`ffmpeg`命令行
   - 文档：优先引导用户安装LibreOffice
2. 转换队列管理系统：
   - 进度回调
   - 错误重试机制
   - 临时文件清理

#### （三）压缩模块

1. 动态生成压缩策略：
   - 图片集：有损压缩
   - 文档集：无损压缩
   - 混合文件：通用压缩
2. 分卷压缩支持
3. 选择多个文件压缩为zip/7z压缩包

#### (四) 查看

1. 在应用内可以直接打开音乐文件、视频文件和图片文件

  - 音乐播放器：
   - 应用最下方显示微透明的播放栏，点击可以向上展开显示音乐信息，如果有歌词则显示
  - 视频播放器：
   - 直接打开占全应用的播放器进行播放

2. 如MarkDown、txt文件等也可直接打开和编辑，无需外部应用

3. 其他文件调用系统默认打开方式打开

### 四、界面实现方案

1. **导航架构**：
   
   ```bash
   ├── 侧边栏导航
   │   ├── 主页(文件分类视图)
   │   ├── 搜索(全局检索,未输入默认显示全部文件)
   │   ├── 设置(主题/权限/存储)
   │   └── 回收站(回收文件，此处回收的文件同步于系统回收站)
   ```

2. **视图组件**：
   
   - 卡片式文件分类展示
   - 可视化格式转换面板
   - 实时搜索建议列表
   - 主题切换预览面板

3. **状态管理**：
   
   - 使用`localStorage`缓存用户偏好
   - 文件树数据使用`immer`管理

4. **设置相关**：
   - 主题：亮色，暗色，粉蓝搭配，粉黑搭配，白粉搭配，紫蓝搭配

   - 配置读取文件路径：一个按钮和一个显示路径的框

   -权限：设置不能回收和访问的目录或文件

5. **右键**：

不能使用的功能依旧显示但是呈现灰色且不能点击

```bash
   ├── 右键导航
   │   ├── 直接打开(上面提到的能够应用内直接打开的)
   │   ├── 外部打开(使用外部其他应用打开)
   │   ├── 在资源管理器中打开(显示所在位置)
   │   ├── 复制
   │   ├── 移动
   │   ├── 粘贴
   │   ├── 刷新
   │   ├── 转换
   │   ├── 压缩(单文件压缩数据，多文件形成压缩包)
   │   ├── (明显分隔线，避免误点击)
   │   ├── 移入回收站
   │   ├── 彻底删除(此功能需访问管理员权限)
   │   ├── (明显分隔线，避免误点击)
   │   └── 属性(显示详细信息)
   ```

6. **事件监听与交互**：
   
   - 窗口控制按钮（最小化、最大化、关闭）
   - 导航菜单切换
   - 主题切换按钮
   - 目录选择按钮
   - 文件点击事件
   - 搜索输入实时响应
   - 右键菜单操作


7. **搜索功能**
   
   - 支持关键词匹配（文件名、类型、修改时间）
   - 实时搜索反馈，结合文件索引优化性能
   - 支持正则表达式搜索（如*.doc,\d{8}.png）

### 五、关键优化点

1. **性能优化**：
   - 文件遍历启用增量加载
   - 采用Web Workers处理计算密集型任务
   - 实现虚拟滚动列表
2. **安全机制**：
   - 文件操作限制在用户指定目录
   - 转换任务沙箱隔离
   - 敏感操作二次确认
3. **异常处理**：
   - 文件锁检测机制
   - 磁盘空间预检
   - 崩溃恢复功能

### 六、开发实施步骤

1. 搭建Electron基础框架
2. 实现核心文件管理模块
3. 开发格式转换适配器
4. 构建基础UI组件
5. 集成状态管理和数据持久化
6. 实现安全防护机制
7. 打包优化与自动更新

### 七、注意事项

1. 文件系统权限需要明确提示
2. 大文件处理需增加进度反馈
3. 格式转换需检测目标格式兼容性
4. 不同平台路径处理需统一标准化
5. 长期运行任务需支持暂停/取消

